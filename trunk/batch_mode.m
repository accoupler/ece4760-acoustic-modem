while (true)
    deriv_detection;
    r = waitforbuttonpress;
    if (r == 0)
        break;
    end
end